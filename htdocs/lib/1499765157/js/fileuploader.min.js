/***

File uploader component is licensed under GNU GPL 2 or later and GNU LGPL 2
or later.
© 2010 Andrew Valums

This distribution also includes:

    server/OctetStreamReader.java
    Dual Licensed under the MIT and GPL v.2

    jQuery JavaScript Library
    http://jquery.com/
    Copyright 2010, John Resig
    Dual licensed under the MIT or GPL Version 2 licenses.
    http://jquery.org/license

    Sizzle.js - CSS selector engine used by jQuery
    http://sizzlejs.com/
    Copyright 2010, The Dojo Foundation
    Released under the MIT, BSD, and GPL Licenses.

    QUnit - A JavaScript Unit Testing Framework
    http://docs.jquery.com/QUnit
    Copyright (c) 2009 John Resig, Jörn Zaefferer
    Dual licensed under the MIT (MIT-LICENSE.txt)
    and GPL (GPL-LICENSE.txt) licenses.

***/

var qq=qq||{};qq.extend=function $qq$extend$($first$$,$second$$){for(var $prop$$ in $second$$)$first$$[$prop$$]=$second$$[$prop$$]};qq.indexOf=function $qq$indexOf$($arr$$,$elt$$,$from$$){if($arr$$.indexOf)return $arr$$.indexOf($elt$$,$from$$);var $from$$=$from$$||0,$len$$=$arr$$.length;for(0>$from$$&&($from$$+=$len$$);$from$$<$len$$;$from$$++)if($from$$ in $arr$$&&$arr$$[$from$$]===$elt$$)return $from$$;return-1};qq.getUniqueId=function(){var $id$$=0;return function(){return $id$$++}}();
qq.ie=function $qq$ie$(){return-1!=navigator.userAgent.indexOf("MSIE")};qq.safari=function $qq$safari$(){return void 0!=navigator.vendor&&-1!=navigator.vendor.indexOf("Apple")};qq.chrome=function $qq$chrome$(){return void 0!=navigator.vendor&&-1!=navigator.vendor.indexOf("Google")};qq.firefox=function $qq$firefox$(){return-1!=navigator.userAgent.indexOf("Mozilla")&&void 0!=navigator.vendor&&""==navigator.vendor};qq.windows=function $qq$windows$(){return"Win32"==navigator.platform};
qq.attach=function $qq$attach$($element$$,$type$$,$fn$$){$element$$.addEventListener?$element$$.addEventListener($type$$,$fn$$,!1):$element$$.attachEvent&&$element$$.attachEvent("on"+$type$$,$fn$$);return function(){qq.detach($element$$,$type$$,$fn$$)}};qq.detach=function $qq$detach$($element$$,$type$$,$fn$$){$element$$.removeEventListener?$element$$.removeEventListener($type$$,$fn$$,!1):$element$$.attachEvent&&$element$$.detachEvent("on"+$type$$,$fn$$)};
qq.preventDefault=function $qq$preventDefault$($e$$){$e$$.preventDefault?$e$$.preventDefault():$e$$.returnValue=!1};qq.insertBefore=function $qq$insertBefore$($a$$,$b$$){$b$$.parentNode.insertBefore($a$$,$b$$)};qq.remove=function $qq$remove$($element$$){$element$$.parentNode.removeChild($element$$)};
qq.contains=function $qq$contains$($parent$$,$descendant$$){return $parent$$==$descendant$$?!0:$parent$$.contains?$parent$$.contains($descendant$$):!!($descendant$$.compareDocumentPosition($parent$$)&8)};qq.toElement=function(){var $div$$=document.createElement("div");return function($element$$){$div$$.innerHTML=$element$$;$element$$=$div$$.firstChild;$div$$.removeChild($element$$);return $element$$}}();
qq.css=function $qq$css$($element$$,$styles$$){null!=$styles$$.opacity&&("string"!=typeof $element$$.style.opacity&&"undefined"!=typeof $element$$.filters)&&($styles$$.filter="alpha(opacity="+Math.round(100*$styles$$.opacity)+")");qq.extend($element$$.style,$styles$$)};qq.hasClass=function $qq$hasClass$($element$$,$name$$){return RegExp("(^| )"+$name$$+"( |$)").test($element$$.className)};
qq.addClass=function $qq$addClass$($element$$,$name$$){qq.hasClass($element$$,$name$$)||($element$$.className+=" "+$name$$)};qq.removeClass=function $qq$removeClass$($element$$,$name$$){$element$$.className=$element$$.className.replace(RegExp("(^| )"+$name$$+"( |$)")," ").replace(/^\s+|\s+$/g,"")};qq.setText=function $qq$setText$($element$$,$text$$){$element$$.innerText=$text$$;$element$$.textContent=$text$$};
qq.children=function $qq$children$($child$$1_element$$){for(var $children$$=[],$child$$1_element$$=$child$$1_element$$.firstChild;$child$$1_element$$;)1==$child$$1_element$$.nodeType&&$children$$.push($child$$1_element$$),$child$$1_element$$=$child$$1_element$$.nextSibling;return $children$$};
qq.getByClass=function $qq$getByClass$($element$$,$className$$){if($element$$.querySelectorAll)return $element$$.querySelectorAll("."+$className$$);for(var $result$$=[],$candidates$$=$element$$.getElementsByTagName("*"),$len$$=$candidates$$.length,$i$$=0;$i$$<$len$$;$i$$++)qq.hasClass($candidates$$[$i$$],$className$$)&&$result$$.push($candidates$$[$i$$]);return $result$$};
qq.obj2url=function $qq$obj2url$($obj$$,$temp$$,$len$$){var $uristrings$$=[],$prefix$$="&",$add$$=function $$add$$$($nextObj$$,$i$$){var $nextTemp$$=$temp$$?/\[\]$/.test($temp$$)?$temp$$:$temp$$+"["+$i$$+"]":$i$$;"undefined"!=$nextTemp$$&&"undefined"!=$i$$&&$uristrings$$.push("object"===typeof $nextObj$$?qq.obj2url($nextObj$$,$nextTemp$$,!0):"[object Function]"===Object.prototype.toString.call($nextObj$$)?encodeURIComponent($nextTemp$$)+"="+encodeURIComponent($nextObj$$()):encodeURIComponent($nextTemp$$)+
"="+encodeURIComponent($nextObj$$))};if(!$len$$&&$temp$$)$prefix$$=/\?/.test($temp$$)?/\?$/.test($temp$$)?"":"&":"?",$uristrings$$.push($temp$$),$uristrings$$.push(qq.obj2url($obj$$));else if("[object Array]"===Object.prototype.toString.call($obj$$)&&"undefined"!=typeof $obj$$)for(var $i$$0$$=0,$len$$=$obj$$.length;$i$$0$$<$len$$;++$i$$0$$)$add$$($obj$$[$i$$0$$],$i$$0$$);else if("undefined"!=typeof $obj$$&&null!==$obj$$&&"object"===typeof $obj$$)for($i$$0$$ in $obj$$)$add$$($obj$$[$i$$0$$],$i$$0$$);
else $uristrings$$.push(encodeURIComponent($temp$$)+"="+encodeURIComponent($obj$$));return $uristrings$$.join($prefix$$).replace(/^&/,"").replace(/%20/g,"+")};qq=qq||{};
qq.FileUploaderBasic=function $qq$FileUploaderBasic$($o$$){this._options={debug:!1,action:"/server/upload",params:{},customHeaders:{},button:null,multiple:!0,maxConnections:3,disableCancelForFormUploads:!1,autoUpload:!0,allowedExtensions:[],acceptFiles:null,sizeLimit:0,minSizeLimit:0,onSubmit:function $this$_options$onSubmit$(){},onComplete:function $this$_options$onComplete$(){},onCancel:function $this$_options$onCancel$(){},onUpload:function $this$_options$onUpload$(){},onProgress:function $this$_options$onProgress$(){},
onError:function $this$_options$onError$(){},messages:{typeError:"{file} has an invalid extension. Only {extensions} {isAre} allowed.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",noFilesError:"No files to upload.",onLeave:"The files are being uploaded, if you leave now the upload will be cancelled."},showMessage:function $this$_options$showMessage$($message$$){alert($message$$)},
inputName:"qqfile"};qq.extend(this._options,$o$$);qq.extend(this,qq.DisposeSupport);this._filesInProgress=0;this._storedFileIds=[];this._handler=this._createUploadHandler();this._options.button&&(this._button=this._createUploadButton(this._options.button));this._preventLeaveInProgress()};
qq.FileUploaderBasic.prototype={setParams:function $qq$FileUploaderBasic$$setParams$($params$$){this._options.params=$params$$},getInProgress:function $qq$FileUploaderBasic$$getInProgress$(){return this._filesInProgress},uploadStoredFiles:function $qq$FileUploaderBasic$$uploadStoredFiles$(){for(var $i$$=0;$i$$<this._storedFileIds.length;$i$$++)this._filesInProgress++,this._handler.upload(this._storedFileIds[$i$$],this._options.params)},clearStoredFiles:function $qq$FileUploaderBasic$$clearStoredFiles$(){this._storedFileIds=
[]},_createUploadButton:function $qq$FileUploaderBasic$$_createUploadButton$($element$$){var $self$$=this,$button$$=new qq.UploadButton({element:$element$$,multiple:this._options.multiple&&qq.UploadHandlerXhr.isSupported(),acceptFiles:this._options.acceptFiles,onChange:function($input$$){$self$$._onInputChange($input$$)}});this.addDisposer(function(){$button$$.dispose()});return $button$$},_createUploadHandler:function $qq$FileUploaderBasic$$_createUploadHandler$(){var $self$$=this,$handlerClass$$;
$handlerClass$$=qq.UploadHandlerXhr.isSupported()?"UploadHandlerXhr":"UploadHandlerForm";return new qq[$handlerClass$$]({debug:this._options.debug,action:this._options.action,encoding:this._options.encoding,maxConnections:this._options.maxConnections,customHeaders:this._options.customHeaders,inputName:this._options.inputName,demoMode:this._options.demoMode,onProgress:function($id$$,$fileName$$,$loaded$$,$total$$){$self$$._onProgress($id$$,$fileName$$,$loaded$$,$total$$);$self$$._options.onProgress($id$$,
$fileName$$,$loaded$$,$total$$)},onComplete:function($id$$,$fileName$$,$result$$){$self$$._onComplete($id$$,$fileName$$,$result$$);$self$$._options.onComplete($id$$,$fileName$$,$result$$)},onCancel:function($id$$,$fileName$$){var $indexToRemove$$=qq.indexOf($self$$._storedFileIds,$id$$);0<=$indexToRemove$$&&$self$$._storedFileIds.splice($indexToRemove$$,1);$self$$._onCancel($id$$,$fileName$$);$self$$._options.onCancel($id$$,$fileName$$)},onError:$self$$._options.onError,onUpload:function($id$$,$fileName$$,
$xhr$$){$self$$._onUpload($id$$,$fileName$$,$xhr$$);$self$$._options.onUpload($id$$,$fileName$$,$xhr$$)}})},_preventLeaveInProgress:function $qq$FileUploaderBasic$$_preventLeaveInProgress$(){var $self$$=this;this._attach(window,"beforeunload",function($e$$){if($self$$._filesInProgress)return $e$$=$e$$||window.event,$e$$.returnValue=$self$$._options.messages.onLeave})},_onSubmit:function $qq$FileUploaderBasic$$_onSubmit$(){this._options.autoUpload&&this._filesInProgress++},_onProgress:function $qq$FileUploaderBasic$$_onProgress$(){},
_onComplete:function $qq$FileUploaderBasic$$_onComplete$($id$$14_indexToRemove$$,$fileName$$,$result$$){$id$$14_indexToRemove$$=qq.indexOf(this._storedFileIds,$id$$14_indexToRemove$$);0<=$id$$14_indexToRemove$$&&this._storedFileIds.splice($id$$14_indexToRemove$$,1);this._filesInProgress--;$result$$.error&&this._options.showMessage($result$$.error)},_onCancel:function $qq$FileUploaderBasic$$_onCancel$(){this._options.autoUpload&&this._filesInProgress--},_onUpload:function $qq$FileUploaderBasic$$_onUpload$(){},
_onInputChange:function $qq$FileUploaderBasic$$_onInputChange$($input$$){this._handler instanceof qq.UploadHandlerXhr?this._uploadFileList($input$$.files):this._validateFile($input$$)&&this._uploadFile($input$$);this._button.reset()},_uploadFileList:function $qq$FileUploaderBasic$$_uploadFileList$($files$$){if(0<$files$$.length){for(var $i$$=0;$i$$<$files$$.length;$i$$++)if(!this._validateFile($files$$[$i$$]))return;for($i$$=0;$i$$<$files$$.length;$i$$++)this._uploadFile($files$$[$i$$])}else this._error("noFilesError",
"")},_uploadFile:function $qq$FileUploaderBasic$$_uploadFile$($fileContainer_id$$){var $fileContainer_id$$=this._handler.add($fileContainer_id$$),$fileName$$=this._handler.getName($fileContainer_id$$);!1!==this._options.onSubmit($fileContainer_id$$,$fileName$$)&&(this._onSubmit($fileContainer_id$$,$fileName$$),this._options.autoUpload?this._handler.upload($fileContainer_id$$,this._options.params):this._storeFileForLater($fileContainer_id$$))},_storeFileForLater:function $qq$FileUploaderBasic$$_storeFileForLater$($id$$){this._storedFileIds.push($id$$)},
_validateFile:function $qq$FileUploaderBasic$$_validateFile$($file$$){var $name$$,$size$$;$file$$.value?$name$$=$file$$.value.replace(/.*(\/|\\)/,""):($name$$=null!==$file$$.fileName&&void 0!==$file$$.fileName?$file$$.fileName:$file$$.name,$size$$=null!==$file$$.fileSize&&void 0!==$file$$.fileSize?$file$$.fileSize:$file$$.size);if(this._isAllowedExtension($name$$)){if(0===$size$$)return this._error("emptyError",$name$$),!1;if($size$$&&this._options.sizeLimit&&$size$$>this._options.sizeLimit)return this._error("sizeError",
$name$$),!1;if($size$$&&$size$$<this._options.minSizeLimit)return this._error("minSizeError",$name$$),!1}else return this._error("typeError",$name$$),!1;return!0},_error:function $qq$FileUploaderBasic$$_error$($code$$,$fileName$$){var $message$$=this._options.messages[$code$$],$extensions_replacement$$=this._options.allowedExtensions.join(", "),$replacement$$inline_1_replacement$$inline_10_replacement$$=this._formatFileName($fileName$$),$message$$=$message$$.replace("{file}",$replacement$$inline_1_replacement$$inline_10_replacement$$),
$message$$=$message$$.replace("{extensions}",$extensions_replacement$$),$replacement$$inline_1_replacement$$inline_10_replacement$$=this._formatSize(this._options.sizeLimit),$message$$=$message$$.replace("{sizeLimit}",$replacement$$inline_1_replacement$$inline_10_replacement$$),$replacement$$inline_1_replacement$$inline_10_replacement$$=this._formatSize(this._options.minSizeLimit),$message$$=$message$$.replace("{minSizeLimit}",$replacement$$inline_1_replacement$$inline_10_replacement$$),$extensions_replacement$$=
-1!=$extensions_replacement$$.indexOf(",")?"are":"is",$message$$=$message$$.replace("{isAre}",$extensions_replacement$$);this._options.showMessage($message$$)},_formatFileName:function $qq$FileUploaderBasic$$_formatFileName$($name$$){33<$name$$.length&&($name$$=$name$$.slice(0,19)+"..."+$name$$.slice(-13));return $name$$},_isAllowedExtension:function $qq$FileUploaderBasic$$_isAllowedExtension$($ext_fileName$$){var $ext_fileName$$=-1!==$ext_fileName$$.indexOf(".")?$ext_fileName$$.replace(/.*[.]/,"").toLowerCase():
"",$allowed$$=this._options.allowedExtensions;if(!$allowed$$.length)return!0;for(var $i$$=0;$i$$<$allowed$$.length;$i$$++)if($allowed$$[$i$$].toLowerCase()==$ext_fileName$$)return!0;return!1},_formatSize:function $qq$FileUploaderBasic$$_formatSize$($bytes$$){var $i$$=-1;do $bytes$$/=1024,$i$$++;while(99<$bytes$$);return Math.max($bytes$$,0.1).toFixed(1)+"kB MB GB TB PB EB".split(" ")[$i$$]}};
qq.FileUploader=function $qq$FileUploader$($o$$){qq.FileUploaderBasic.apply(this,arguments);qq.extend(this._options,{element:null,listElement:null,dragText:"Drop files here to upload",extraDropzones:[],uploadButtonText:"Upload a file",cancelButtonText:"Cancel",failUploadText:"Upload failed",multipleFileDropNotAllowedMessage:"You may only drop one file",template:'<div class="qq-uploader"><div class="qq-upload-drop-area"><span>{dragText}</span></div><div class="qq-upload-button">{uploadButtonText}</div><ul class="qq-upload-list"></ul></div>',
fileTemplate:'<li><span class="qq-progress-bar"></span><span class="qq-upload-spinner"></span><span class="qq-upload-finished"></span><span class="qq-upload-file"></span><span class="qq-upload-size"></span><a class="qq-upload-cancel" href="#">{cancelButtonText}</a><span class="qq-upload-failed-text">{failUploadtext}</span></li>',classes:{button:"qq-upload-button",drop:"qq-upload-drop-area",dropActive:"qq-upload-drop-area-active",dropDisabled:"qq-upload-drop-area-disabled",list:"qq-upload-list",progressBar:"qq-progress-bar",
file:"qq-upload-file",spinner:"qq-upload-spinner",finished:"qq-upload-finished",size:"qq-upload-size",cancel:"qq-upload-cancel",success:"qq-upload-success",fail:"qq-upload-fail",successIcon:null,failIcon:null}});qq.extend(this._options,$o$$);this._options.messages.tooManyFilesError=this._options.multipleFileDropNotAllowedMessage;this._options.template=this._options.template.replace(/\{dragText\}/g,this._options.dragText);this._options.template=this._options.template.replace(/\{uploadButtonText\}/g,
this._options.uploadButtonText);this._options.fileTemplate=this._options.fileTemplate.replace(/\{cancelButtonText\}/g,this._options.cancelButtonText);this._options.fileTemplate=this._options.fileTemplate.replace(/\{failUploadtext\}/g,this._options.failUploadText);this._element=this._options.element;this._element.innerHTML=this._options.template;this._listElement=this._options.listElement||this._find(this._element,"list");this._classes=this._options.classes;this._button=this._createUploadButton(this._find(this._element,
"button"));this._bindCancelEvent();this._setupDragDrop()};qq.extend(qq.FileUploader.prototype,qq.FileUploaderBasic.prototype);
qq.extend(qq.FileUploader.prototype,{clearStoredFiles:function(){qq.FileUploaderBasic.prototype.clearStoredFiles.apply(this,arguments);this._listElement.innerHTML=""},addExtraDropzone:function($element$$){this._setupExtraDropzone($element$$)},removeExtraDropzone:function($element$$){var $dzs$$=this._options.extraDropzones,$i$$;for($i$$ in $dzs$$)if($dzs$$[$i$$]===$element$$)return this._options.extraDropzones.splice($i$$,1)},_leaving_document_out:function($e$$){return(qq.chrome()||qq.safari()&&qq.windows())&&
0==$e$$.clientX&&0==$e$$.clientY||qq.firefox()&&!$e$$.relatedTarget},_storeFileForLater:function($id$$){qq.FileUploaderBasic.prototype._storeFileForLater.apply(this,arguments);var $item$$=this._getItemByFileId($id$$);this._find($item$$,"spinner").style.display="none"},_find:function($parent$$,$type$$){var $element$$=qq.getByClass($parent$$,this._options.classes[$type$$])[0];if(!$element$$)throw Error("element not found "+$type$$);return $element$$},_setupExtraDropzone:function($element$$){this._options.extraDropzones.push($element$$);
this._setupDropzone($element$$)},_setupDropzone:function($dropArea$$){var $self$$=this,$dz$$=new qq.UploadDropZone({element:$dropArea$$,onEnter:function($e$$){qq.addClass($dropArea$$,$self$$._classes.dropActive);$e$$.stopPropagation()},onLeave:function(){},onLeaveNotDescendants:function(){qq.removeClass($dropArea$$,$self$$._classes.dropActive)},onDrop:function($e$$){$dropArea$$.style.display="none";qq.removeClass($dropArea$$,$self$$._classes.dropActive);1<$e$$.dataTransfer.files.length&&!$self$$._options.multiple?
$self$$._error("tooManyFilesError",""):$self$$._uploadFileList($e$$.dataTransfer.files)}});this.addDisposer(function(){$dz$$.dispose()});$dropArea$$.style.display="none"},_setupDragDrop:function(){var $dropArea$$=this._find(this._element,"drop"),$self$$=this;this._options.extraDropzones.push($dropArea$$);var $dropzones$$=this._options.extraDropzones,$i$$;for($i$$=0;$i$$<$dropzones$$.length;$i$$++)this._setupDropzone($dropzones$$[$i$$]);qq.ie()||this._attach(document,"dragenter",function(){if(!qq.hasClass($dropArea$$,
$self$$._classes.dropDisabled)){$dropArea$$.style.display="block";for($i$$=0;$i$$<$dropzones$$.length;$i$$++)$dropzones$$[$i$$].style.display="block"}});this._attach(document,"dragleave",function($e$$){document.elementFromPoint($e$$.clientX,$e$$.clientY);if(qq.FileUploader.prototype._leaving_document_out($e$$))for($i$$=0;$i$$<$dropzones$$.length;$i$$++)$dropzones$$[$i$$].style.display="none"});qq.attach(document,"drop",function($e$$){for($i$$=0;$i$$<$dropzones$$.length;$i$$++)$dropzones$$[$i$$].style.display=
"none";$e$$.preventDefault()})},_onSubmit:function($id$$,$fileName$$){qq.FileUploaderBasic.prototype._onSubmit.apply(this,arguments);this._addToList($id$$,$fileName$$)},_onProgress:function($id$$,$fileName$$,$loaded$$,$total$$){qq.FileUploaderBasic.prototype._onProgress.apply(this,arguments);var $item$$=this._getItemByFileId($id$$);$loaded$$===$total$$&&(this._find($item$$,"cancel").style.display="none");var $size$$=this._find($item$$,"size");$size$$.style.display="inline";var $text$$,$percent$$=
Math.round(100*($loaded$$/$total$$));$text$$=$loaded$$!=$total$$?$percent$$+"% from "+this._formatSize($total$$):this._formatSize($total$$);this._find($item$$,"progressBar").style.width=$percent$$+"%";qq.setText($size$$,$text$$)},_onComplete:function($id$$,$fileName$$,$result$$){qq.FileUploaderBasic.prototype._onComplete.apply(this,arguments);var $item$$=this._getItemByFileId($id$$);(!this._options.disableCancelForFormUploads||qq.UploadHandlerXhr.isSupported())&&qq.remove(this._find($item$$,"cancel"));
qq.remove(this._find($item$$,"spinner"));if($result$$.success)qq.addClass($item$$,this._classes.success),this._classes.successIcon&&(this._find($item$$,"finished").style.display="inline-block",qq.addClass($item$$,this._classes.successIcon));else{var $errorReason$$=$result$$.reason?$result$$.reason:"Unknown error";qq.addClass($item$$,this._classes.fail);this._classes.failIcon&&(this._find($item$$,"finished").style.display="inline-block",qq.addClass($item$$,this._classes.failIcon));$item$$.title=$errorReason$$}},
_onUpload:function($id$$,$fileName$$,$xhr$$){qq.FileUploaderBasic.prototype._onUpload.apply(this,arguments);var $item$$=this._getItemByFileId($id$$),$item$$=this._find($item$$,"spinner");"none"==$item$$.style.display&&($item$$.style.display="inline-block")},_addToList:function($id$$,$fileName$$){var $item$$=qq.toElement(this._options.fileTemplate);if(this._options.disableCancelForFormUploads&&!qq.UploadHandlerXhr.isSupported()){var $cancelLink$$=this._find($item$$,"cancel");qq.remove($cancelLink$$)}$item$$.qqFileId=
$id$$;$cancelLink$$=this._find($item$$,"file");qq.setText($cancelLink$$,this._formatFileName($fileName$$));this._find($item$$,"size").style.display="none";this._options.multiple||this._clearList();this._listElement.appendChild($item$$)},_clearList:function(){this._listElement.innerHTML="";this.clearStoredFiles()},_getItemByFileId:function($id$$){for(var $item$$=this._listElement.firstChild;$item$$;){if($item$$.qqFileId==$id$$)return $item$$;$item$$=$item$$.nextSibling}},_bindCancelEvent:function(){var $self$$=
this;this._attach(this._listElement,"click",function($e$$20_item$$){var $e$$20_item$$=$e$$20_item$$||window.event,$target$$=$e$$20_item$$.target||$e$$20_item$$.srcElement;qq.hasClass($target$$,$self$$._classes.cancel)&&(qq.preventDefault($e$$20_item$$),$e$$20_item$$=$target$$.parentNode,$self$$._handler.cancel($e$$20_item$$.qqFileId),qq.remove($e$$20_item$$))})}});
qq.UploadDropZone=function $qq$UploadDropZone$($o$$){this._options={element:null,onEnter:function $this$_options$onEnter$(){},onLeave:function $this$_options$onLeave$(){},onLeaveNotDescendants:function $this$_options$onLeaveNotDescendants$(){},onDrop:function $this$_options$onDrop$(){}};qq.extend(this._options,$o$$);qq.extend(this,qq.DisposeSupport);this._element=this._options.element;this._disableDropOutside();this._attachEvents()};
qq.UploadDropZone.prototype={_dragover_should_be_canceled:function $qq$UploadDropZone$$_dragover_should_be_canceled$(){return qq.safari()||qq.firefox()&&qq.windows()},_disableDropOutside:function $qq$UploadDropZone$$_disableDropOutside$(){qq.UploadDropZone.dropOutsideDisabled||(this._dragover_should_be_canceled?qq.attach(document,"dragover",function($e$$){$e$$.preventDefault()}):qq.attach(document,"dragover",function($e$$){$e$$.dataTransfer&&($e$$.dataTransfer.dropEffect="none",$e$$.preventDefault())}),
qq.UploadDropZone.dropOutsideDisabled=!0)},_attachEvents:function $qq$UploadDropZone$$_attachEvents$(){var $self$$=this;$self$$._attach($self$$._element,"dragover",function($e$$){if($self$$._isValidFileDrag($e$$)){var $effect$$=qq.ie()?null:$e$$.dataTransfer.effectAllowed;$e$$.dataTransfer.dropEffect="move"==$effect$$||"linkMove"==$effect$$?"move":"copy";$e$$.stopPropagation();$e$$.preventDefault()}});$self$$._attach($self$$._element,"dragenter",function($e$$){if($self$$._isValidFileDrag($e$$))$self$$._options.onEnter($e$$)});
$self$$._attach($self$$._element,"dragleave",function($e$$){if($self$$._isValidFileDrag($e$$)){$self$$._options.onLeave($e$$);var $relatedTarget$$=document.elementFromPoint($e$$.clientX,$e$$.clientY);if(!qq.contains(this,$relatedTarget$$))$self$$._options.onLeaveNotDescendants($e$$)}});$self$$._attach($self$$._element,"drop",function($e$$){$self$$._isValidFileDrag($e$$)&&($e$$.preventDefault(),$self$$._options.onDrop($e$$))})},_isValidFileDrag:function $qq$UploadDropZone$$_isValidFileDrag$($dt_e$$){if(qq.ie())return!1;
var $dt_e$$=$dt_e$$.dataTransfer,$isSafari$$=qq.safari();return $dt_e$$&&"none"!=$dt_e$$.effectAllowed&&($dt_e$$.files||!$isSafari$$&&$dt_e$$.types.contains&&$dt_e$$.types.contains("Files"))}};
qq.UploadButton=function $qq$UploadButton$($o$$){this._options={element:null,multiple:!1,acceptFiles:null,name:"file",onChange:function $this$_options$onChange$(){},hoverClass:"qq-upload-button-hover",focusClass:"qq-upload-button-focus"};qq.extend(this._options,$o$$);qq.extend(this,qq.DisposeSupport);this._element=this._options.element;qq.css(this._element,{position:"relative",overflow:"hidden",direction:"ltr"});this._input=this._createInput()};
qq.UploadButton.prototype={getInput:function $qq$UploadButton$$getInput$(){return this._input},reset:function $qq$UploadButton$$reset$(){this._input.parentNode&&qq.remove(this._input);qq.removeClass(this._element,this._options.focusClass);this._input=this._createInput()},_createInput:function $qq$UploadButton$$_createInput$(){var $input$$=document.createElement("input");this._options.multiple&&$input$$.setAttribute("multiple","multiple");this._options.acceptFiles&&$input$$.setAttribute("accept",this._options.acceptFiles);
$input$$.setAttribute("type","file");$input$$.setAttribute("name",this._options.name);qq.css($input$$,{position:"absolute",right:0,top:0,fontFamily:"Arial",fontSize:"118px",margin:0,padding:0,cursor:"pointer",opacity:0});this._element.appendChild($input$$);var $self$$=this;this._attach($input$$,"change",function(){$self$$._options.onChange($input$$)});this._attach($input$$,"mouseover",function(){qq.addClass($self$$._element,$self$$._options.hoverClass)});this._attach($input$$,"mouseout",function(){qq.removeClass($self$$._element,
$self$$._options.hoverClass)});this._attach($input$$,"focus",function(){qq.addClass($self$$._element,$self$$._options.focusClass)});this._attach($input$$,"blur",function(){qq.removeClass($self$$._element,$self$$._options.focusClass)});window.attachEvent&&$input$$.setAttribute("tabIndex","-1");return $input$$}};
qq.UploadHandlerAbstract=function $qq$UploadHandlerAbstract$($o$$){this._options={debug:!1,action:"/upload.php",maxConnections:999,onProgress:function $this$_options$onProgress$(){},onComplete:function $this$_options$onComplete$(){},onCancel:function $this$_options$onCancel$(){},onUpload:function $this$_options$onUpload$(){}};qq.extend(this._options,$o$$);this._queue=[];this._params=[]};
qq.UploadHandlerAbstract.prototype={log:function $qq$UploadHandlerAbstract$$log$($str$$){this._options.debug&&window.console&&console.log("[uploader] "+$str$$)},add:function $qq$UploadHandlerAbstract$$add$(){},upload:function $qq$UploadHandlerAbstract$$upload$($id$$,$params$$){var $len$$=this._queue.push($id$$),$copy$$={};qq.extend($copy$$,$params$$);this._params[$id$$]=$copy$$;$len$$<=this._options.maxConnections&&this._upload($id$$,this._params[$id$$])},cancel:function $qq$UploadHandlerAbstract$$cancel$($id$$){this._cancel($id$$);
this._dequeue($id$$)},cancelAll:function $qq$UploadHandlerAbstract$$cancelAll$(){for(var $i$$=0;$i$$<this._queue.length;$i$$++)this._cancel(this._queue[$i$$]);this._queue=[]},getName:function $qq$UploadHandlerAbstract$$getName$(){},getSize:function $qq$UploadHandlerAbstract$$getSize$(){},getQueue:function $qq$UploadHandlerAbstract$$getQueue$(){return this._queue},_upload:function $qq$UploadHandlerAbstract$$_upload$(){},_cancel:function $qq$UploadHandlerAbstract$$_cancel$(){},_dequeue:function $qq$UploadHandlerAbstract$$_dequeue$($i$$11_id$$){$i$$11_id$$=
qq.indexOf(this._queue,$i$$11_id$$);this._queue.splice($i$$11_id$$,1);var $max$$=this._options.maxConnections;this._queue.length>=$max$$&&$i$$11_id$$<$max$$&&($i$$11_id$$=this._queue[$max$$-1],this._upload($i$$11_id$$,this._params[$i$$11_id$$]))}};qq.UploadHandlerForm=function $qq$UploadHandlerForm$($o$$){qq.UploadHandlerAbstract.apply(this,arguments);this._inputs={};this._detach_load_events={}};qq.extend(qq.UploadHandlerForm.prototype,qq.UploadHandlerAbstract.prototype);
qq.extend(qq.UploadHandlerForm.prototype,{add:function($fileInput$$){$fileInput$$.setAttribute("name",this._options.inputName);var $id$$="qq-upload-handler-iframe"+qq.getUniqueId();this._inputs[$id$$]=$fileInput$$;$fileInput$$.parentNode&&qq.remove($fileInput$$);return $id$$},getName:function($id$$){return this._inputs[$id$$].value.replace(/.*(\/|\\)/,"")},_cancel:function($id$$){this._options.onCancel($id$$,this.getName($id$$));delete this._inputs[$id$$];delete this._detach_load_events[$id$$];if($id$$=
document.getElementById($id$$))$id$$.setAttribute("src","javascript:false;"),qq.remove($id$$)},_upload:function($id$$,$params$$){this._options.onUpload($id$$,this.getName($id$$),!1);var $input$$=this._inputs[$id$$];if(!$input$$)throw Error("file with passed id was not added, or already uploaded or cancelled");var $fileName$$=this.getName($id$$),$iframe$$=this._createIframe($id$$),$form$$=this._createForm($iframe$$,$params$$);$form$$.appendChild($input$$);var $self$$=this;this._attachLoadEvent($iframe$$,
function(){$self$$.log("iframe loaded");var $response$$=$self$$._getIframeContentJSON($iframe$$);$self$$._options.onComplete($id$$,$fileName$$,$response$$);$self$$._dequeue($id$$);delete $self$$._inputs[$id$$];setTimeout(function(){$self$$._detach_load_events[$id$$]();delete $self$$._detach_load_events[$id$$];qq.remove($iframe$$)},1)});$form$$.submit();qq.remove($form$$);return $id$$},_attachLoadEvent:function($iframe$$,$callback$$){this._detach_load_events[$iframe$$.id]=qq.attach($iframe$$,"load",
function(){if($iframe$$.parentNode){try{if($iframe$$.contentDocument&&$iframe$$.contentDocument.body&&"false"==$iframe$$.contentDocument.body.innerHTML)return}catch($error$$){}$callback$$()}})},_getIframeContentJSON:function($iframe$$){try{var $doc$$=$iframe$$.contentDocument?$iframe$$.contentDocument:$iframe$$.contentWindow.document,$response$$,$innerHTML$$=$doc$$.body.innerHTML;this.log("converting iframe's innerHTML to JSON");this.log("innerHTML = "+$innerHTML$$);"<pre"==$innerHTML$$.slice(0,4).toLowerCase()&&
"</pre>"==$innerHTML$$.slice(-6).toLowerCase()&&($innerHTML$$=$doc$$.body.firstChild.firstChild.nodeValue);$response$$=eval("("+$innerHTML$$+")")}catch($err$$){$response$$={success:!1}}return $response$$},_createIframe:function($id$$){var $iframe$$=qq.toElement('<iframe src="javascript:false;" name="'+$id$$+'" />');$iframe$$.setAttribute("id",$id$$);$iframe$$.style.display="none";document.body.appendChild($iframe$$);return $iframe$$},_createForm:function($iframe$$,$params$$){var $form$$=qq.toElement('<form method="'+
(this._options.demoMode?"GET":"POST")+'" enctype="multipart/form-data"></form>'),$queryString$$=qq.obj2url($params$$,this._options.action);$form$$.setAttribute("action",$queryString$$);$form$$.setAttribute("target",$iframe$$.name);$form$$.style.display="none";document.body.appendChild($form$$);return $form$$}});qq.UploadHandlerXhr=function $qq$UploadHandlerXhr$($o$$){qq.UploadHandlerAbstract.apply(this,arguments);this._files=[];this._xhrs=[];this._loaded=[]};
qq.UploadHandlerXhr.isSupported=function $qq$UploadHandlerXhr$isSupported$(){var $input$$=document.createElement("input");$input$$.type="file";return"multiple"in $input$$&&"undefined"!=typeof File&&"undefined"!=typeof FormData&&"undefined"!=typeof(new XMLHttpRequest).upload};qq.extend(qq.UploadHandlerXhr.prototype,qq.UploadHandlerAbstract.prototype);
qq.extend(qq.UploadHandlerXhr.prototype,{add:function($file$$){if(!($file$$ instanceof File))throw Error("Passed obj in not a File (in qq.UploadHandlerXhr)");return this._files.push($file$$)-1},getName:function($file$$3_id$$){$file$$3_id$$=this._files[$file$$3_id$$];return null!==$file$$3_id$$.fileName&&void 0!==$file$$3_id$$.fileName?$file$$3_id$$.fileName:$file$$3_id$$.name},getSize:function($file$$4_id$$){$file$$4_id$$=this._files[$file$$4_id$$];return null!=$file$$4_id$$.fileSize?$file$$4_id$$.fileSize:
$file$$4_id$$.size},getLoaded:function($id$$){return this._loaded[$id$$]||0},_upload:function($id$$,$params$$){this._options.onUpload($id$$,this.getName($id$$),!0);var $file$$=this._files[$id$$],$name$$=this.getName($id$$);this.getSize($id$$);this._loaded[$id$$]=0;var $xhr$$=this._xhrs[$id$$]=new XMLHttpRequest,$self$$=this;$xhr$$.upload.onprogress=function $$xhr$$$upload$onprogress$($e$$){$e$$.lengthComputable&&($self$$._loaded[$id$$]=$e$$.loaded,$self$$._options.onProgress($id$$,$name$$,$e$$.loaded,
$e$$.total))};$xhr$$.onreadystatechange=function $$xhr$$$onreadystatechange$(){4==$xhr$$.readyState&&$self$$._onComplete($id$$,$xhr$$)};$params$$=$params$$||{};$params$$[this._options.inputName]=$name$$;var $formData_queryString$$=qq.obj2url($params$$,this._options.action);$xhr$$.open(this._options.demoMode?"GET":"POST",$formData_queryString$$,!0);$xhr$$.setRequestHeader("X-Requested-With","XMLHttpRequest");$xhr$$.setRequestHeader("X-File-Name",encodeURIComponent($name$$));"multipart"==this._options.encoding?
($formData_queryString$$=new FormData,$formData_queryString$$.append(this._options.inputName,$file$$),$file$$=$formData_queryString$$):($xhr$$.setRequestHeader("Content-Type","application/octet-stream"),$xhr$$.setRequestHeader("X-Mime-Type",$file$$.type));for(key in this._options.customHeaders)$xhr$$.setRequestHeader(key,this._options.customHeaders[key]);$xhr$$.send($file$$)},_onComplete:function($id$$,$xhr$$){if(this._files[$id$$]){var $name$$=this.getName($id$$),$size$$=this.getSize($id$$);this._options.onProgress($id$$,
$name$$,$size$$,$size$$);if(200==$xhr$$.status){this.log("xhr - server response received");this.log("responseText = "+$xhr$$.responseText);var $response$$;try{$response$$=eval("("+$xhr$$.responseText+")")}catch($err$$){$response$$={}}this._options.onComplete($id$$,$name$$,$response$$)}else this._options.onError($id$$,$name$$,$xhr$$),this._options.onComplete($id$$,$name$$,{});this._xhrs[$id$$]=null;this._dequeue($id$$)}},_cancel:function($id$$){this._options.onCancel($id$$,this.getName($id$$));this._files[$id$$]=
null;this._xhrs[$id$$]&&(this._xhrs[$id$$].abort(),this._xhrs[$id$$]=null)}});qq.DisposeSupport={_disposers:[],dispose:function $qq$DisposeSupport$dispose$(){for(var $disposer$$;$disposer$$=this._disposers.shift();)$disposer$$()},addDisposer:function $qq$DisposeSupport$addDisposer$($disposeFunction$$){this._disposers.push($disposeFunction$$)},_attach:function $qq$DisposeSupport$_attach$(){this.addDisposer(qq.attach.apply(this,arguments))}};